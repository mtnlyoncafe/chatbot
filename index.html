<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>AI PMC - Chatbot</title>
  <style>
    body { font-family: Arial, sans-serif; line-height: 22px; }
.chat-box { background:#eef4ff; padding:5px; border-left:4px solid #003399;
            border-radius:6px; min-height:200px; }

    .info-box {
      background: #ffffff;
      padding: 5px;
    }

    .chat-box {
      background: #eef4ff;
      padding: 5px;
      border-left: 4px solid #003399;
      border-radius: 6px;
      min-hight: 200px;
    }

    input, button {
      padding: 5px;
      font-size: 16px;
    }

    input {
      width: 60%;
      margin-right: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    button {
      background-color: #003399;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    button:hover {
      background-color: #002266;
    }

    .important {
      font-weight: bold;
      color: #c00;
    }
    #response {
  background: #eef4ff;
  padding: 15px;
  margin-top: 20px;
  border-left: 4px solid #003399;
  border-radius: 6px;
          /* ‚ö° Gi·ªõi h·∫°n chi·ªÅu cao */
  overflow-y: auto;          /* ‚ö° B·∫≠t cu·ªôn n·∫øu v∆∞·ª£t qu√° */
}

  </style>
</head>
<body>
  <div class="info-box">
     <h2>AI_pmc h·ªó tr·ª£ ·ª©ng d·ª•ng AI trong Qu·∫£n l√Ω X√¢y D·ª±ng.</h2> 
    <div id="response" class="chat-box">
      <p>PMC h√¢n h·∫°nh ƒë∆∞·ª£c h·ªó tr·ª£ b·∫°n!</p>
    </div>
    
    <form id="chat-form">
      <h3>üì® G·ª≠i c√¢u h·ªèi c·ªßa b·∫°n</h3>
      <input type="text" id="message" placeholder="Nh·∫≠p c√¢u h·ªèi..." required />
      <button type="submit">G·ª≠i</button>
    </form>

   
  </div>

 <script>
  <script>
  function getReply(data){
    // H·ªó tr·ª£ nhi·ªÅu d·∫°ng ph·∫£n h·ªìi kh√°c nhau
    return (
      data?.reply ??
      data?.message ??
      data?.content ??
      data?.choices?.[0]?.message?.content ??
      ''
    );
  }

  document.getElementById('chat-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const input = document.getElementById('message');
    const msg = input.value.trim();
    const box = document.getElementById('response');
    if(!msg) return;

    try{
      const res = await fetch('/api/chat', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ message: msg })
      });

      const data = await res.json().catch(()=> ({}));
      let reply = getReply(data);

      if(!reply) reply = 'Kh√¥ng c√≥ ph·∫£n h·ªìi t·ª´ m√°y ch·ªß.'; // fallback

      const formatted = reply
        .toString()
        .replace(/\n/g,'<br>')
        .replace(/(?:\*\*)(.*?)\*\*/g,'<strong>$1</strong>');

      box.innerHTML += `
        <div style="margin-top:16px">
          <p><strong>üë§ B·∫°n:</strong> ${msg}</p>
          <p><strong>ü§ñ AI:</strong> ${formatted}</p>
        </div>`;
      input.value = '';
      box.scrollTop = box.scrollHeight;
    }catch(err){
      box.innerHTML += `
        <div style="color:#c00;margin-top:16px">
          <strong>L·ªói:</strong> Kh√¥ng th·ªÉ k·∫øt n·ªëi m√°y ch·ªß.
        </div>`;
      console.error(err);
    }
  });
</script>

</script>

</body>
</html>
